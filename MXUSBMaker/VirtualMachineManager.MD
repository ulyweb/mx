# ğŸ§© 1. The Best Virtualization Stack for MXâ€‘25.1

MX Linux (especially MXâ€‘25.1) is Debianâ€‘based and plays extremely well with:

## **Option A â€” KVM + QEMU + Virtâ€‘Manager (BEST CHOICE)**  
This is the **native Linux hypervisor**, built into the kernel.

### Why itâ€™s the best:
- **Fastest performance** (hardware virtualization via KVM)
- **Native snapshot support**
- **Supports qcow2 images** (copyâ€‘onâ€‘write, compressed, encrypted)
- **Perfect for offline / airâ€‘gapped VMs**
- **Stable, openâ€‘source, no proprietary drivers**
- **Used by securityâ€‘focused distros (Qubes, Whonix, Tails devs)**

### Install everything:
```bash
sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients virt-manager
```

---
# ğŸ† **Conclusion: Use KVM + QEMU + Virtâ€‘Manager**  
This is the professionalâ€‘grade solution.

---

# ğŸ§± 2. How to Configure KVM Properly on MXâ€‘25.1

Hereâ€™s the correct setup for a stable, snapshotâ€‘friendly VM environment.

---

## **Step 1 â€” Enable KVM hardware virtualization**
Check if your CPU supports it:

```bash
egrep -c '(vmx|svm)' /proc/cpuinfo
```

If the result is **1 or higher**, youâ€™re good.

---

## **Step 2 â€” Add yourself to the libvirt group**
```bash
sudo usermod -aG libvirt $USER
sudo usermod -aG kvm $USER
```

Log out and back in.

---

## **Step 3 â€” Create a qcow2 disk (supports snapshots)**
Inside Virtâ€‘Manager:

- Storage format: **qcow2**
- Enable:
  - **Copyâ€‘onâ€‘write**
  - **Compression**
  - **Sparse allocation**

This gives you:

- Fast snapshots  
- Small disk footprint  
- Easy cloning  
- Perfect for offline images  

---

## **Step 4 â€” Enable UEFI (OVMF)**
This ensures your VM matches modern hardware.

Install firmware:

```bash
sudo apt install ovmf
```

In Virtâ€‘Manager â†’ Firmware â†’ **UEFI (OVMF)**

---

## **Step 5 â€” Enable VirtIO drivers**
For:

- Disk  
- Network  
- Display  

This gives you nearâ€‘native performance.

---

# ğŸ“¸ 3. Creating Snapshots the Right Way

Inside Virtâ€‘Manager:

1. Shut down the VM  
2. Open **View â†’ Snapshots**  
3. Click **Take Snapshot**  
4. Name it something meaningful:
   - `baseline-clean`
   - `post-hardening`
   - `airgap-final`

Snapshots are stored inside the qcow2 file.

---

# ğŸ§Š 4. Creating a â€œFrozenâ€ Airâ€‘Gapped MX Linux Image

This is the part you care about most.

You want:

- Your fully configured MXâ€‘25.1  
- All apps installed  
- All settings applied  
- No internet  
- No updates  
- No external attack surface  

Hereâ€™s how to do it properly.

---

## **Step 1 â€” Build your perfect MX Linux inside the VM**
Install:

- All apps  
- All configs  
- All hardening  
- All scripts  
- All privacy tools  

Get it EXACTLY how you want it.

---

## **Step 2 â€” Take a â€œgolden snapshotâ€**
Name it:

```
gold-master
```

This is your **immutable baseline**.

---

## **Step 3 â€” Clone the VM**
Virtâ€‘Manager â†’ Rightâ€‘click VM â†’ **Clone**

Choose:

- **Full clone** (not linked clone)
- Storage format: **qcow2**

This gives you a **standalone, portable, offline VM**.

---

## **Step 4 â€” Disable networking**
Inside Virtâ€‘Manager:

- NIC â†’ **Remove hardware**

Inside the VM:

- Disable NetworkManager  
- Remove DNS resolvers  
- Remove DHCP client  

Now the VM is **airâ€‘gapped**.

---

## **Step 5 â€” Export the VM**
Virtâ€‘Manager â†’ File â†’ **Export**

This produces a portable VM image you can store offline.

---

# ğŸ” 5. Why This Is Secure and Beneficial

### âœ” Airâ€‘gapped = immune to:
- Malware  
- Remote exploits  
- Supplyâ€‘chain attacks  
- Zeroâ€‘days  
- Telemetry  
- Network leaks  

### âœ” Snapshots = perfect rollback
If anything breaks:

- Roll back in 2 seconds  
- No reinstall  
- No reconfiguration  

### âœ” qcow2 = encrypted, compressed, copyâ€‘onâ€‘write
- Small file size  
- Fast  
- Secure  
- Easy to duplicate  

### âœ” VM isolation = hardware sandbox
Your host OS cannot be compromised by the VM, and viceâ€‘versa.

### âœ” Perfect for:
- Secure research  
- Malware analysis  
- Offline development  
- Privacyâ€‘focused workflows  
- Immutable computing  

---


# ğŸ§© 1. Letâ€™s build this like an infrastructure person.

## Iâ€™ll walk you through:

1. Installing KVM + QEMU + libvirt + Virtâ€‘Manager on MXâ€‘25.1  
2. Verifying hardware virtualization is actually working  
3. Correct libvirt/user/group setup  
4. Creating a VM from your existing MX ISO  
5. Tuning the VM for performance and snapshots  
6. Taking and using snapshots like a pro  

---

### 1. Install KVM, QEMU, libvirt, Virtâ€‘Manager

Open a terminal in your **installed MXâ€‘25.1** (not live):

```bash
sudo apt update
sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients virt-manager bridge-utils ovmf
```

**What each piece is:**

- **qemu-kvm:** KVMâ€‘accelerated virtualization backend  
- **libvirt-daemon-system / libvirt-clients:** libvirt service + CLI tools  
- **virt-manager:** GUI to manage VMs  
- **bridge-utils:** for advanced networking (optional but good to have)  
- **ovmf:** UEFI firmware for VMs  

---

### 2. Verify hardware virtualization support

Run:

```bash
egrep -c '(vmx|svm)' /proc/cpuinfo
```

- **Result â‰¥ 1:** CPU supports virtualization  
- **Result = 0:** VTâ€‘x/AMDâ€‘V disabled in BIOS/UEFI â†’ enable it there first  

Then check KVM modules:

```bash
lsmod | grep kvm
```

You should see:

- `kvm_intel` or `kvm_amd`  
- `kvm`  

If not, try:

```bash
sudo modprobe kvm
sudo modprobe kvm_intel   # or kvm_amd
```

---

### 3. Add your user to the right groups

So you donâ€™t have to run everything as root:

```bash
sudo usermod -aG libvirt $USER
sudo usermod -aG kvm $USER
```

Then **log out and log back in** (group changes only apply to new sessions).

You can confirm:

```bash
groups
```

You should see `libvirt` and `kvm` in the list.

---

### 4. Start and verify libvirtd

On MX (Debianâ€‘based), libvirt is usually managed via systemd even if the system uses sysvinit for PID 1.

Check status:

```bash
sudo systemctl status libvirtd
```

If itâ€™s not active:

```bash
sudo systemctl enable --now libvirtd
```

---

### 5. Launch Virtâ€‘Manager

From your MX menu, open:

> **Virtual Machine Manager** (virt-manager)

Or from terminal:

```bash
virt-manager
```

You should see:

- A connection: **QEMU/KVM â€“ System**  
- Status: **Connected**

If it shows â€œNot connectedâ€, click it and connect.

---

### 6. Create a new VM from your existing MX ISO

You said you already have an MX snapshot ISO â€” perfect.

In Virtâ€‘Manager:

1. **File â†’ New Virtual Machine**
2. **Step 1 â€“ Choose how to install:**
   - Select: **Local install media (ISO image or CDROM)**
3. **Step 2 â€“ Choose ISO:**
   - Click **Browse** â†’ **Browse Local**
   - Select your MX snapshot ISO
   - OS type: **Linux**
   - Version: **Debian 12** or **Generic Linux 6.x** (close enough)
4. **Step 3 â€“ Memory and CPU:**
   - **RAM:**  
     - 4 GB (4096 MB) minimum for comfort  
     - 8 GB if you have enough host RAM  
   - **CPUs:**  
     - 2 vCPUs minimum  
     - 4 if your host has 8+ threads
5. **Step 4 â€“ Storage:**
   - Check **Create a disk image for the virtual machine**
   - Size:  
     - 40â€“80 GB if you plan to install a lot  
   - Click **Customize configuration before install** (important)
6. **Step 5 â€“ Name:**
   - Name it something like: `mx25-golden-vm`
   - Click **Finish** â†’ this opens the VM details before boot

---

### 7. Correct VM configuration (engineeringâ€‘grade)

In the VM details window:

#### **Overview â†’ Firmware**

- **Firmware:** select **UEFI (OVMF)** if available  
  - This matches modern hardware and futureâ€‘proofs the VM

#### **Overview â†’ Chipset**

- Use **Q35** if available (more modern), otherwise **i440FX** is fine.

---

#### **CPUs**

- **Model:** hostâ€‘passthrough (best performance)
- **vCPUs:** 2â€“4 depending on your host
- Enable:
  - **Copy host CPU configuration** if available

---

#### **Memory**

- **Current allocation:** 4096â€“8192 MB  
- **Max allocation:** same as current (no ballooning needed for your use case)

---

#### **Disk (vda)**

Click the disk:

- **Bus type:** set to **VirtIO** (for performance)
- **Cache mode:** `writeback` or `none` (default is usually fine)
- **Storage format:** should be **qcow2** (this is critical for snapshots)

If itâ€™s not qcow2, recreate the disk as qcow2:

- Delete the disk  
- Add Hardware â†’ Storage â†’ qcow2 â†’ set size  

---

#### **Network**

Click **NIC**:

- **Device model:** `virtio`  
- If you plan to airâ€‘gap this VM:
  - For now, leave it enabled to install and update  
  - Later, you can **remove the NIC** entirely

---

#### **Display**

- **Type:** `Spice`  
- **Video model:** `QXL` or `Virtio` (for better performance)

---

When done, click **Begin Installation**.

---

### 8. Install MX inside the VM (from your snapshot ISO)

You know this part already, but key points:

- Boot from your snapshot ISO  
- Install MX to the virtual disk (vda)  
- Reboot into the installed system (not the live ISO)  
- Confirm everything works: apps, configs, etc.

At this point, you have:

- A **virtual MX** that mirrors your configured system  
- Running on **KVM** with **qcow2** storage  

Now we make it snapshotâ€‘friendly and airâ€‘gapâ€‘ready.

---

### 9. Take a â€œgoldenâ€ snapshot

Shut down the VM cleanly.

In Virtâ€‘Manager:

1. Select your VM (`mx25-golden-vm`)
2. **View â†’ Snapshots**
3. Click **Take Snapshot**
4. Name it: `baseline-clean` or `gold-master`
5. Optionally add a description:  
   - â€œFresh install from MX snapshot ISO, fully configuredâ€

This snapshot is your **frozen, knownâ€‘good state**.

---

### 10. Clone the VM for experiments

Instead of abusing the golden VM, clone it.

In Virtâ€‘Manager:

1. Rightâ€‘click your VM â†’ **Clone**
2. Name: `mx25-lab-1` or similar
3. Choose:
   - **Clone type:** Full clone
   - This creates a separate qcow2 file
4. Finish

Now you have:

- `mx25-golden-vm` â†’ untouched baseline  
- `mx25-lab-1` â†’ playground  

---

### 11. Airâ€‘gap the VM

Once youâ€™re happy with the internal state and donâ€™t need internet:

1. Shut down the VM
2. In Virtâ€‘Manager â†’ VM details â†’ **NIC**
3. Click **Remove Hardware**

Now the VM has **no network card at all**.

Inside the VM, you can also:

- Disable NetworkManager  
- Remove any leftover network configs  

Result: **true airâ€‘gap** â€” no network stack, no IP, no DNS, nothing.

---

### 12. Using snapshots in â€œengineering modeâ€

For your lab VM (`mx25-lab-1`):

- Before big changes:
  - Shut down  
  - Take a snapshot: `pre-change-X`
- After changes:
  - If happy â†’ keep going  
  - If broken â†’ revert snapshot

To revert:

1. Shut down the VM
2. Virtâ€‘Manager â†’ Snapshots
3. Select snapshot â†’ **Revert**

This is instant rollback.

---

### 13. Using your existing MX snapshot ISO inside this flow

You said:

> â€œOnce I have setup I will use my current snapshot that's ISO already and see if it works or notâ€

Thatâ€™s exactly what we did:

- You used your **MX snapshot ISO** as the install media  
- Installed it into a **KVM VM**  
- Took a **golden snapshot**  
- Cloned it for experiments  
- Airâ€‘gapped it by removing NIC  

So now you have:

- A **virtualized, reproducible version** of your tuned MX system  
- Snapshots for rollback  
- Airâ€‘gap capability for security  
- All of it running on **native Linux virtualization**  

---
